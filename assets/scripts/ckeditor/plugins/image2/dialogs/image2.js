/*
 Copyright (c) 2003-2013, CKSource - Frederico Knabben. All rights reserved.
 For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("image2",function(c){function w(){var a=this.getValue().match(x);(a=!!(a&&0!==parseInt(a[1],10)))||alert(j["invalid"+CKEDITOR.tools.capitalize(this.id)]);return a}function F(){function a(a,b){d.push(g.once(a,function(a){for(var g;g=d.pop();)g.removeListener();b(a)}))}var g=p.createElement("img"),d=[];return function(d,b,c){a("load",function(){b.call(c,g,g.$.width,g.$.height)});a("error",function(){b(null)});a("abort",function(){b(null)});g.setAttribute("src",d+"?"+Math.random().toString(16).substring(2))}}
function y(){var a=this.getValue();q(!1);a!==t.data.src?(z(a,function(a,d,b){q(!0);if(!a)return k(!1);h.setValue(d);i.setValue(b);r=d;s=b;k(A.checkHasNaturalRatio(a))}),l=!0):l?(q(!0),h.setValue(m),i.setValue(n),l=!1):q(!0)}function B(){if(e){var a=this.getValue();if(a&&(a.match(x)||k(!1),"0"!==a)){var b="width"==this.id,d=m||r,c=n||s,a=b?Math.round(c*(a/d)):Math.round(d*(a/c));isNaN(a)||(b?i:h).setValue(a)}}}function k(a){if(f){if("boolean"==typeof a){if(u)return;e=a}else if(a=h.getValue(),u=!0,
(e=!e)&&a)a*=n/m,isNaN(a)||i.setValue(Math.round(a));f[e?"removeClass":"addClass"]("cke_btn_unlocked");f.setAttribute("aria-checked",e);CKEDITOR.env.hc&&f.getChild(0).setHtml(e?CKEDITOR.env.ie?"■":"▣":CKEDITOR.env.ie?"□":"▢")}}function q(a){a=a?"enable":"disable";h[a]();i[a]()}var x=/(^\s*(\d+)(px)?\s*$)|^$/i,C=CKEDITOR.tools.getNextId(),D=CKEDITOR.tools.getNextId(),b=c.lang.image2,j=c.lang.common,G=(new CKEDITOR.template('<div><a href="javascript:void(0)" tabindex="-1" title="'+b.lockRatio+'" class="cke_btn_locked" id="{lockButtonId}" role="checkbox"><span class="cke_icon"></span><span class="cke_label">'+
b.lockRatio+'</span></a><a href="javascript:void(0)" tabindex="-1" title="'+b.resetSize+'" class="cke_btn_reset" id="{resetButtonId}" role="button"><span class="cke_label">'+b.resetSize+"</span></a></div>")).output({lockButtonId:C,resetButtonId:D}),A=CKEDITOR.plugins.image2,H=A.getNatural,p,t,E,z,m,n,r,s,l,e,u,f,o,h,i,v,b={title:b.title,minWidth:250,minHeight:100,onLoad:function(){p=this._.element.getDocument();z=F()},onShow:function(){t=this.widget;E=t.parts.image;l=u=e=!1;v=H(E);r=m=v.width;s=n=
v.height},contents:[{id:"info",label:c.lang.image2.infoTab,elements:[{type:"vbox",padding:0,children:[{type:"hbox",widths:["280px","110px"],align:"right",children:[{id:"src",type:"text",label:j.url,onKeyup:y,onChange:y,setup:function(a){this.setValue(a.data.src)},commit:function(a){a.setData("src",this.getValue())},validate:CKEDITOR.dialog.validate.notEmpty(b.urlMissing)},{type:"button",id:"browse",style:"display:inline-block;margin-top:16px;",align:"center",label:c.lang.common.browseServer,hidden:!0,
filebrowser:"info:src"}]}]},{id:"alt",type:"text",label:b.alt,setup:function(a){this.setValue(a.data.alt)},commit:function(a){a.setData("alt",this.getValue())}},{type:"hbox",widths:["25%","25%","50%"],requiredContent:"img[width,height]",children:[{type:"text",width:"45px",id:"width",label:j.width,validate:w,onKeyUp:B,onLoad:function(){h=this},setup:function(a){this.setValue(a.data.width)},commit:function(a){a.setData("width",this.getValue())}},{type:"text",id:"height",width:"45px",label:j.height,
validate:w,onKeyUp:B,onLoad:function(){i=this},setup:function(a){this.setValue(a.data.height)},commit:function(a){a.setData("height",this.getValue())}},{id:"lock",type:"html",style:"margin-top:18px;width:40px;height:20px;",onLoad:function(){function a(a){a.on("mouseover",function(){this.addClass("cke_btn_over")},a);a.on("mouseout",function(){this.removeClass("cke_btn_over")},a)}var b=this.getDialog();f=p.getById(C);o=p.getById(D);f&&(b.addFocusable(f,4),f.on("click",function(a){k();a.data&&a.data.preventDefault()},
this.getDialog()),a(f));o&&(b.addFocusable(o,5),o.on("click",function(a){if(l){h.setValue(r);i.setValue(s)}else{h.setValue(m);i.setValue(n)}a.data&&a.data.preventDefault()},this),a(o))},setup:function(a){k(a.data.lock)},commit:function(a){a.setData("lock",e)},html:G}]},{type:"hbox",id:"alignment",children:[{id:"align",type:"radio",items:[["None","none"],["Left","left"],["Center","center"],["Right","right"]],label:j.align,setup:function(a){this.setValue(a.data.align)},commit:function(a){a.setData("align",
this.getValue())}}]},{id:"hasCaption",type:"checkbox",label:b.captioned,setup:function(a){this.setValue(a.data.hasCaption)},commit:function(a){a.setData("hasCaption",this.getValue())}}]},{id:"Upload",hidden:!0,filebrowser:"uploadButton",label:c.lang.image2.uploadTab,elements:[{type:"file",id:"upload",label:c.lang.image2.btnUpload,style:"height:40px",size:38},{type:"fileButton",id:"uploadButton",filebrowser:"info:src",label:c.lang.image2.btnUpload,"for":["Upload","upload"]}]}]};!c.config.filebrowserImageBrowseUrl&&
!c.config.filebrowserBrowseUrl&&(b.contents[0].elements[0].children[0]=b.contents[0].elements[0].children[0].children[0]);return b});