CKEDITOR.dialog.add("insertCode",function(c){var h=[],j=[],i=c.lang.code,g,d,f;for(g=0;g<c.config.codeModes.length;++g)h.push([c.config.codeModes[g],c.config.codeModes[g].toLowerCase()]);for(d in c.config.codeAlias)c.config.codeAlias.hasOwnProperty(d)&&h.push([c.code.getMode(d).name,d]);for(d in c.config.codeThemes)c.config.codeThemes.hasOwnProperty(d)&&j.push([d,c.config.codeThemes[d]]);h.sort(function(a,c){return a[0].localeCompare(c[0])});return{title:i.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,
width:650,height:550,contents:[{id:"editor",elements:[{type:"hbox",style:"margin-top: -10px;",children:[{id:"mode",type:"select",label:i.language,labelStyle:"font-weight: bold; color: #8E9091; font-size: 1.15em; margin-top: 10px;",labelLayout:"horizontal",widths:[60,190],items:h,"default":(c.config.codeDefaultMode||"html").toLowerCase(),setup:function(a){a=a.parts.editable;(a=c.code.getMode(a.getAttribute("type")||a.getAttribute("mode")))&&this.setValue(a.alias||a.mode)},commit:function(a){var e=
a.parts.editable,b=c.code.getMode(this.getValue());b&&(e.setAttribute("mode",b.alias||b.mode),b.type?e.setAttribute("type",b.type):e.removeAttribute("type"),a.parts.title.setHtml(i.blockTitle.replace(":mode",b.name)),CodeMirror.requireMode?(e=this.getValue(),CodeMirror.requireMode(e,function(){a.codeMirror.setOption("mode",b.type||b.mode)})):a.codeMirror.setOption("mode",b.type||b.mode))},onChange:function(){if(CodeMirror.requireMode){var a=this.getValue();CodeMirror.requireMode(a,function(){f.setOption("mode",
a)})}else f.setOption("mode",this.getValue())}},{id:"theme",type:"select",label:i.theme,labelStyle:"font-weight: bold; color: #8E9091; font-size: 1.15em; margin-top: 10px;",labelLayout:"horizontal",widths:[60,190],items:j,"default":(c.config.codeDefaultTheme||"default").toLowerCase(),setup:function(a){a=a.parts.editable;a.getAttribute("theme")&&this.setValue(a.getAttribute("theme"))},commit:function(a){var e=a.parts.editable,b=this.getValue();e.setAttribute("theme",b);a.codeMirror.setOption("theme",
b);"default"!==b&&(CodeMirror.hasOwnProperty("themeURL")&&!c.code.loadedThemes.hasOwnProperty(b))&&(c.document.appendStyleSheet(CodeMirror.themeURL.replace("%N",b)),c.code.loadedThemes[b]=1)},onChange:function(){f.setOption("theme",this.getValue())}}]},{id:"cm-editor",type:"textarea",setup:function(a){f.setValue(a.codeMirror.getValue())},commit:function(a){a.codeMirror.setValue(f.getValue())}}]}],onLoad:function(){var a=this,e=this.getContentElement("editor","cm-editor").getElement(),b=function(c){var b=
function(a){if(c.state.focused)return a.cancel(),a.stop(),!1};a._.element.on("key",b,null,null,1);a._.element.on("keyup",b,null,null,1);a._.element.on("keydown",b,null,null,1);a._.element.on("keypress",b,null,null,1)},d=CKEDITOR.tools.extend({mode:"text/x-htmlmixed",theme:"default",value:"",lineNumbers:!0,autoCloseBrackets:!0,autoCloseTags:!0,matchBrackets:!0,matchTags:!0,indentWithTabs:!0,tabSize:4,styleActiveLine:!0},c.config.codeMirrorConfig);CodeMirror.requireMode?CodeMirror.requireMode("htmlmixed",
function(){f=CodeMirror(e.getParent().$,d);b(f)}):(f=CodeMirror(e.getParent().$,d),b(f));e.setStyle("display","none")}}});