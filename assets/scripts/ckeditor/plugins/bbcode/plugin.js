(function(){function j(a){return a.replace(/\(|\)|\[|\]|\{|\}|\:|\/|\?|\+|\$|\.|\^|\*|\-|\|/g,function(a){return"\\"+a})}function m(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/&shy;/g,"­")}function n(a){return a.replace(/ *, */g,",").replace(/"|'/g,"").toLowerCase()}CKEDITOR.config.bbCodeAutoClose=!0;CKEDITOR.config.bbCodeTags="all";CKEDITOR.config.bbCodeFilters="all";CKEDITOR.config.extraBBCodeFilters=
"";CKEDITOR.config.extraBBCodeTags="";CKEDITOR.plugins.bbCode={};CKEDITOR.plugins.bbCode.tools={escapeRegExp:j,decodeHtml:m};CKEDITOR.plugins.bbCode.COLOR_PATTERN=/^(\#[a-f0-9]{3,6}|[a-z]+)$/i;CKEDITOR.plugins.bbCode.NUMBER_PATTERN=/^([1-9]+[0-9]*|[0-9])$/i;CKEDITOR.plugins.bbCode.bbCodeParser={};CKEDITOR.plugins.bbCode.bbCodeParser.parse=function(a){var b,d,c,f=0,g=/(?:\[([^\/\]"'= ]+)(?:=("[^"]*"|'[^']*'|[^\]"' ]*)?|((?: [^\/\]="' ]+=(?:"[^"]*"|'[^']*'|[^\]"' ]*))*))?\]|\[\/([^\/\]"'= ]+)\])/g;
for(b=d=new CKEDITOR.plugins.bbCode.BBCodeNode(CKEDITOR.NODE_DOCUMENT,{bbCode:a});c=g.exec(a);){f<c.index&&d.append(new CKEDITOR.plugins.bbCode.BBCodeNode(CKEDITOR.NODE_TEXT,{value:a.substring(f,c.index)}));if(c[2]){var f=c[2].charAt(0),e=c[2].charAt(c[2].length-1);if(f===e&&("'"===f||'"'===e))c[2]=c[2].substring(1,c[2].length-1)}c[4]?d=d.close(c[4].toLowerCase(),c[0]):(c=new CKEDITOR.plugins.bbCode.BBCodeNode(CKEDITOR.NODE_ELEMENT,{openTag:c[0],name:c[1],value:c[2]||"",attributes:c[3]?this.parseAttributes(c[3]):
{}}),d.append(c),d=c);f=g.lastIndex}a.length>f&&b.append(new CKEDITOR.plugins.bbCode.BBCodeNode(CKEDITOR.NODE_TEXT,{value:a.substring(f,a.length)}));return b};CKEDITOR.plugins.bbCode.bbCodeParser.parseAttributes=function(a){for(var b,d={},c=/(?:([^= ]+)+=(?:('[^']*'|"[^"]*")|([^ ]*)))/g;b=c.exec(a);)d[b[1]]=b[2]?b[2].substring(1,b[2].length-1):b[3];return d};CKEDITOR.plugins.bbCode.BBCodeNode=function(a,b){this.type=a;this.children=[];this.isEmpty=!0;this.nodeLevel=0;CKEDITOR.tools.extend(this,b,
!1);this.closeTag=this.closeTag||"";this.openTag=this.openTag||"";if((this.value=this.value||"")&&this.attributes)this.attributes.$=this.value};CKEDITOR.plugins.bbCode.BBCodeNode.prototype={forEach:function(a){var b,d,c=Array.prototype.splice.call(arguments,1,arguments.length),f=this.children.length;for(b=0;b<f;++b)if(this.children[b].type!==CKEDITOR.NODE_DELETED&&(d=a.apply(this.children[b],c),!1===d))return!1;return d},append:function(a){return this.add(a,0)},prepend:function(a){return this.add(a)},
add:function(a,b){var d;d=this.children.length;a.parent=this;a.nodeLevel=this.nodeLevel+1;"undefined"===typeof b||d>b?(d&&(d=this.children[d-1],a.previous=d,d.next=a),this.children.push(a)):0>=b?(d&&(d=this.children[0],a.next=d,d.previous=a),this.children.unshift(a)):(d=this.children[b],d.previous&&(a.previous=d.previous,d.previous.next=a),a.next=d,d.previous=a,this.children.splice(b,0,a));this.isEmpty=!1;return this},clear:function(){this.children=[];this.isEmpty=!0;return this},close:function(a,
b){if(this.type===CKEDITOR.NODE_ELEMENT){if(a===this.name)return this.closeTag=b,this.parent;if(this.parent){var d=this.parent;do if(d.name===a)return d.close(a,b);while(d=d.parent)}}this.append(new CKEDITOR.plugins.bbCode.BBCodeNode(CKEDITOR.NODE_TEXT,{value:b}));return this},content:function(){if(this.type===CKEDITOR.NODE_TEXT)return this.value;var a="";this.forEach(function(){a+=this.openTag+this.content()+this.closeTag});return a}};CKEDITOR.plugins.bbCode.BBCode=function(a){var b,d=this,c=a.config,
f=[],g=[];this.editor=a;f="all"===c.bbCodeTags?"b s u i sub sup url email img color background size font indent center right left justify youtube vimeo spoiler hide acronym code quote list".split(" "):c.bbCodeTags.split(/ *, */g);f.concat(c.extraBBCodeTags.split(/ *, */g));g="all"===c.bbCodeFilters?["smiley"]:c.bbCodeFilters.split(/ *, */g);g.concat(c.extraBBCodeFilters.split(/ *, */g));for(b=0;b<f.length;++b)switch(f[b]){case "b":this.defineTag("b","b",{allowedContent:"strong b",alternativeTags:["strong"]});
break;case "s":this.defineTag("s","s",{allowedContent:"s strike",alternativeTags:["strike"]});break;case "i":this.defineTag("i","em",{allowedContent:"i em",alternativeTags:["i"]});break;case "u":this.defineTag("u","u",{allowedContent:"u"});break;case "sub":this.defineTag("sub","sub",{allowedContent:"sub"});break;case "sup":this.defineTag("sup","sup",{allowedContent:"sup"});break;case "url":var e=this.defineTag("url","a",{allowedContent:"a[!href]",attributes:{href:{map:"$",required:!0,encode:encodeURI,
decode:decodeURI,htmlPattern:/^(?!mailref:)/i}}});e.on("beforeToHtml",function(a){a=a.data.node;a.value||(a.attributes.$=CKEDITOR.tools.trim(a.content()))});e.on("toBBCode",function(a){var b=a.data.node;!b.isEmpty&&(b.children.length&&b.children[0].type===CKEDITOR.NODE_TEXT&&m(b.children[0].value)===m(a.data.bbCode.value))&&(a.data.bbCode.value=void 0)});break;case "email":this.defineTag("email","a",{attributes:{allowedContent:"a[!href]",href:{map:"$",required:!0,encode:encodeURIComponent,decode:decodeURIComponent,
bbCodeFormat:"mailref:{1}",htmlPattern:/^mailref:(.*)$/i,htmlFormat:"{1}"}}});break;case "img":e=this.defineTag("img","img",{allowedContent:"img[!src,alt,title]",attributes:{src:{map:"$",required:!0,encode:encodeURI,decode:decodeURI},alt:{map:"alt",required:!1},title:{map:"alt",required:!1}}});e.on("beforeToHtml",function(a){a=a.data.node;a.attributes.$?a.attributes.alt=a.content():a.attributes.$=CKEDITOR.tools.trim(a.content());a.clear()});e.on("toBBCode",function(a){var b=a.data.node,a=a.data.bbCode;
a.attributes.alt?(b.add(new CKEDITOR.htmlParser.text(a.attributes.alt),0),b.isEmpty=!1,delete a.attributes.alt):(b.add(new CKEDITOR.htmlParser.text(a.value),0),b.isEmpty=!1,a.value=void 0)});break;case "color":this.defineTag("color","span",{allowedContent:"span{!color}",attributes:{style:{map:"$",style:"color",required:!0,bbCodePattern:CKEDITOR.plugins.bbCode.COLOR_PATTERN,htmlPattern:CKEDITOR.plugins.bbCode.COLOR_PATTERN}}});break;case "background":this.defineTag("background","span",{allowedContent:"span{!background-color}",
attributes:{style:{map:"$",style:"background-color",required:!0,bbCodePattern:CKEDITOR.plugins.bbCode.COLOR_PATTERN,htmlPattern:CKEDITOR.plugins.bbCode.COLOR_PATTERN}}});break;case "size":for(var e={},h=[],i=/(?:([^;\/]+)\/)?([^;\/]+);?/g,k,l=1;k=i.exec(a.config.fontSize_sizes);)k[1]?(e[k[1].toLowerCase()]=k[2],h.push(k[1])):(e[l]=k[2],h.push(l)),++l;this.defineTag("size","span",{allowedContent:"span{!font-size}",sizes:e,attributes:{style:{map:"$",style:"font-size",required:!0,bbCodePattern:RegExp("^("+
h.join("|")+")$","i"),bbCodeFormat:function(a){return this.options.sizes[a.toLowerCase()]},htmlFormat:function(a){for(var b in this.options.sizes)if(this.options.sizes.hasOwnProperty(b)&&this.options.sizes[b]===a)return b}}}});break;case "font":var j,h={},i={};k=c.font_names.split(";");for(l=0;l<k.length;++l)k[l]&&((j=/^([^\/]+)\/(.+)$/.exec(k[l]))?(e=j[1],j=j[2]):e=j=k[l],h[e.toLowerCase()]=CKEDITOR.tools.htmlEncodeAttr(j),i[n(j)]=e);this.defineTag("font","span",{allowedContent:"span{!font-family}",
fontFamilyMap:h,fontFamilyReverseMap:i,attributes:{style:{style:"font-family",required:!0,bbCodeFormat:function(a){a=a.toLowerCase();if(this.options.fontFamilyMap.hasOwnProperty(a))return this.options.fontFamilyMap[a]},htmlFormat:function(a){a=n(a);if(this.options.fontFamilyReverseMap.hasOwnProperty(a))return this.fontFamilyReverseMap[a]}}}});break;case "indent":this.defineTag("indent","div",{allowedContent:"div{margin-left,margin-right};p{margin-left,margin-right}",priority:0,alternativeTags:["ul",
"ol","p"],max:0,step:a.config.indentOffset||40,unit:a.config.indentUnit||"px",attributes:{style:{style:"margin-left",required:!0,bbCodePattern:CKEDITOR.plugins.bbCode.NUMBER_PATTERN,bbCodeFormat:function(a){a=Number(a);return!a||0<this.options.max&&a>this.options.max?!1:""+a*this.options.step+this.options.unit},htmlFormat:function(a){var b=this.options.unit;if(a.indexOf(b)!==a.length-b.length)return!1;a=a.substring(0,a.length-b.length);if(isNaN(a)||!isFinite(a))return!1;a=Number(a)/this.options.step;
return a%1||this.options.max&&a>this.options.max?!1:""+a}}}});break;case "center":this.defineTag("center","div",{allowedContent:"div{text-align}",priority:1,alternativeTags:["ul","ol","pre","p"],attributes:{style:{required:!0,style:"text-align",value:"center"}}});break;case "left":this.defineTag("left","div",{allowedContent:"div{text-align}",priority:1,alternativeTags:["ul","ol","pre","p"],attributes:{style:{required:!0,style:"text-align",value:"left"}}});break;case "right":this.defineTag("right",
"div",{allowedContent:"div{text-align}",priority:1,alternativeTags:["ul","ol","pre","p"],attributes:{style:{required:!0,style:"text-align",value:"right"}}});break;case "justify":this.defineTag("justify","div",{allowedContent:"div{text-align}",priority:1,alternativeTags:["ul","ol","pre","p"],attributes:{style:{required:!0,style:"text-align",value:"justify"}}});break;case "youtube":e=this.defineTag("youtube","iframe",{allowedContent:"iframe[src,width,height,frameborder,contenteditable,youtube-player-start]",
priority:10,attributes:{src:{map:"src",encode:encodeURI,decode:decodeURI,required:!0,bbCodePattern:/(?:youtube(?:-nocookie)?\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i,bbCodeFormat:"https://youtube.com/embed/{1}",htmlPattern:/^https?:\/\/youtube.com\/embed\/([^"&?\/ ]{11})/i,htmlFormat:"https://www.youtube.com/watch?v={1}"},"youtube-player-start":{map:"$",required:!1,bbCodePattern:/(^[0-9]+$)|(^(?:\d+:)?(?:\d\d?[:.])?\d\d?$)/,bbCodeFormat:function(a){if(!a.match(/^[0-9]+$/)){var b=
a.split(/[:.]/g);b.reverse();a=0;if(3<b.length||0===b.length)return!1;for(var c=0;c<b.length;++c){if(isNaN(b[c])||2>c&&59<b[c])return;a+=Number(b[c])*Math.pow(60,c)}a=""+a}return a},htmlPattern:/\d+/},width:{value:"640"},height:{value:"390"},frameborder:{value:"0"},contenteditable:{value:"false"}}});e.on("beforeToHtml",function(a){a=a.data.node;a.attributes.src=a.content();a.clear()});e.on("beforeToBBCode",function(a){var a=a.data.node,b=a.attributes.src,c;if(b&&!a.attributes["youtube-player-start"]&&
(c=b.match(/\?start=([0-9]+)/i)))a.attributes["youtube-player-start"]=c[1]});e.on("toHtml",function(a){a=a.data.html;a.attributes["youtube-player-start"]&&(a.attributes.src+="?start="+a.attributes["youtube-player-start"])});e.on("toBBCode",function(a){var b=a.data.node,a=a.data.bbCode;b.add(new CKEDITOR.htmlParser.text(a.attributes.src),0);b.isEmpty=!1;delete a.attributes.src});break;case "vimeo":e=this.defineTag("vimeo","iframe",{allowedContent:"iframe[src,width,height,frameborder,contenteditable]",
priority:10,attributes:{src:{map:"src",required:!0,bbCodePattern:/^(?:https?:\/\/)?(?:www\.)?(?:player\.)?vimeo\.com\/(?:[a-z]*\/)*([0-9]{6,})[?]?./i,bbCodeFormat:"//player.vimeo.com/video/{1}",htmlPattern:/^(?:https?:)?\/\/player.vimeo.com\/video\/([0-9){6,}])/i,htmlFormat:"http://www.vimeo.com/{1}"},width:{value:"640"},height:{value:"390"},frameborder:{value:"0"},contenteditable:{value:"false"}}});e.on("beforeToHtml",function(a){a=a.data.node;a.attributes.src=a.content();a.clear()});e.on("toBBCode",
function(a){var b=a.data.node,a=a.data.bbCode;b.add(new CKEDITOR.htmlParser.text(a.attributes.src),0);b.isEmpty=!1;delete a.attributes.src});break;case "hide":this.defineTag("hide","span",{allowedContent:"span(bbc-hide-text)",attributes:{"class":{required:!0,value:"bbc-hide-text"}}});break;case "spoiler":this.defineTag("spoiler","div",{allowedContent:"div[!cke-spoiler-wrapper](!spoiler-wrapper);div(!spoiler-title);div(!spoiler-content);",renderOpenTagHtml:function(){return'<div class="spoiler-wrapper" cke-spoiler-wrapper="1"><div class="spoiler-title" >'+
(this.editor.lang.hasOwnProperty("spoiler")?this.editor.lang.spoiler.title:"Spoiler")+'</div><div class="spoiler-content">'},renderCloseTagHtml:function(){return"</div></div>"},parseContent:!0,attributes:{"class":{required:!0,value:"spoiler-wrapper"}}}).on("toBBCode",function(a){var a=a.data.node,b,c;if(a.isEmpty)return!1;for(var d=0;d<a.children.length;++d)a.children[d].hasClass("spoiler-title")?b=d:a.children[d].hasClass("spoiler-content")&&(c=d);if("undefined"===typeof b||"undefined"===typeof c)return!1;
c=a.children[c];c.isEmpty?(a.children=[],a.isEmpty=!0):(a.children=c.children,a.isEmpty=!1)});break;case "acronym":this.defineTag("acronym","acronym",{allowedContent:"acronym[!title]",attributes:{title:{map:"$",required:!0}}});break;case "quote":this.defineTag("quote","blockquote",{priority:1});break;case "code":this.defineTag("code","code",{priority:1,parseContent:!1,allowThemes:!0,allowedContent:"code[mode];code[theme];code[type]",attributes:{mode:{map:"lang",required:!1},theme:{map:"theme",required:!1}}}).on("toBBCode",
function(a){var b=a.data.node,a=a.data.bbCode;b.attributes.theme||(a.attributes={},b.attributes.mode&&(a.value=b.attributes.mode))})}for(b=0;b<g.length;++b)switch(g[b]){case "smiley":this.addFilter("smiley",new CKEDITOR.plugins.bbCode.SmileyFilter(a))}a.on("instanceReady",function(){for(var b in d.tags)if(d.tags.hasOwnProperty(b)){var c=d.tags[b].options.allowedContent;"string"===typeof c&&!a.filter.check(c,!0,!0)&&a.filter.allow(c,"bbCode",!0)}})};CKEDITOR.plugins.bbCode.BBCode.prototype={tags:{},
filters:{},skipBr:0,output:[],editor:null,defineTag:function(a,b,d){b=new CKEDITOR.plugins.bbCode.BBCodeRule(this.editor,a,b,d);return this.tags[a]=b},addFilter:function(a,b){this.filters[a]=b;return this},toHtml:function(a){this.writeBBCodeNode(CKEDITOR.plugins.bbCode.bbCodeParser.parse(a),!0);a=this.output.join("");this.reset();return a},toBBCode:function(a){this.writeHtmlNode(CKEDITOR.htmlParser.fragment.fromHtml(a),!0);a=this.output.join("");this.reset();return a},writeHtmlNode:function(a,b){var d,
c="",f="";d={node:a,parse:b};if(!1!==this.applyFilters(d,"bbCode","beforeParse"))if(a=d.node,b=d.parse,a.type===CKEDITOR.NODE_TEXT)c=m(a.value||""),d={node:a,parse:b,content:c},!1!==this.applyFilters(d,"bbCode","afterParse")&&this.output.push(d.content);else{if(a.type===CKEDITOR.NODE_ELEMENT){var g;if(b){if("br"===a.name){this.output.push("\r\n");return}d=[];var e;a.attributes.style=CKEDITOR.tools.parseCssText(a.attributes.style||"");for(var h in this.tags)if(this.tags.hasOwnProperty(h)){var i=this.tags[h];
a.name.match(i.htmlRegExp)&&(i.checkValidHtmlContext(a)&&(e=i.toBBCode(a)))&&d.push(e)}if(d.length){c=[];f=[];d.sort(this.sortPriority);for(e=0;e<d.length;++e){i=h="";d[e].brBeforeOpen&&(i+="\r\n");if(d[e].renderOpenTag)i+=d[e].renderOpenTag(a,d[e],e);else{i+="["+d[e].name;if(d[e].value)i+='="'+d[e].value+'"';else for(g in d[e].attributes)d[e].attributes.hasOwnProperty(g)&&(i+=" "+g+'="'+d[e].attributes[g]+'"');i+="]"}d[e].brAfterOpen&&(i+="\r\n");d[e].brBeforeClose&&(h+="\r\n");h=d[e].renderCloseTag?
h+d[e].renderCloseTag(a,d[e],e):h+("[/"+d[e].name+"]");d[e].brAfterClose&&(h+="\r\n");f.unshift(h);c.push(i)}b=Boolean(d[0].parseContent);c=c.join("");f=f.join("")}}else{c="<"+a.name;for(g in a.attributes)a.attributes.hasOwnProperty(g)&&(c+=" "+g+'="'+a.attributes[g]);c+=">";if(!a.isOptionalClose||!a.isEmpty)f="</"+a.name+">"}}d={node:a,parse:b,open:c,close:f};if(!1!==this.applyFilters(d,"bbCode","afterParse")){d.open&&this.output.push(d.open);if(!a.isEmpty&&a.children&&a.children.length)for(c=0;c<
a.children.length;++c)this.writeHtmlNode(a.children[c],b);d.close&&this.output.push(d.close)}}},writeBBCodeNode:function(a,b){var d,c=!1,f=a.openTag,g="",g=a.closeTag;d={node:a,parse:b};if(!1!==this.applyFilters(d,"html","beforeParse"))if(a=d.node,b=d.parse,a.type===CKEDITOR.NODE_TEXT)g=CKEDITOR.tools.htmlEncode(a.value),b&&(g=g.replace(/\r\n|[\r\n]/g,"<br>")),this.skipBr&&(g=g.replace(/(^<br>)/,""),this.skipBr=!1),d.content=g,!1!==this.applyFilters(d,"html","afterParse")&&this.output.push(d.content);
else{if(a.type===CKEDITOR.NODE_ELEMENT){var e,h;if(b&&(g||this.editor.config.bbCodeAutoClose)&&this.tags.hasOwnProperty(a.name)&&this.tags[a.name].checkValidBBCodeContext(a)&&(h=this.tags[a.name].toHtml(a))){c=a.isEmpty?0:a.children.length;if(h.renderOpenTag)f=h.renderOpenTag.apply(this.tags[a.name],[a,h]);else{f="<"+h.name;if("object"===typeof h.attributes.style){for(var i in h.attributes.style){h.attributes.style.hasOwnProperty(i)&&(h.attributes.style=CKEDITOR.tools.writeCssText(h.attributes.style));
break}"string"===typeof h.attributes.style||delete h.attributes.style}for(e in h.attributes)h.attributes.hasOwnProperty(e)&&(f+=" "+e+'="'+h.attributes[e]+'"');f+=">"}g=h.renderCloseTag?h.renderCloseTag.apply(this.tags[a.name],[a,h]):"</"+h.name+">";h.brBeforeOpen&&this.output[this.output.length-1].replace(/(<br>$)/,"");h.brAfterClose&&(this.skipBr=!0);h.brBeforeClose&&(c&&a.children[c-1].type===CKEDITOR.NODE_TEXT)&&(a.children[c-1].value=a.children[c-1].value.replace(/(\r\n|[\r\n])$/,""));h.brAfterOpen&&
(c&&a.children[0].type===CKEDITOR.NODE_TEXT)&&(a.children[0].value=a.children[0].value.replace(/^(\r\n|[\r\n])/,""));c=h.stripContent;b=Boolean(h.parseContent)}}d.close=g;d.open=f;if(!1!==this.applyFilters(d,"html","afterParse")){d.open&&this.output.push(d.open);if(b){if(!a.isEmpty&&!0!==c)for(f=0;f<a.children.length;++f)c!==a.type&&this.writeBBCodeNode(a.children[f],b)}else this.output.push(CKEDITOR.tools.htmlEncode(a.content()));d.close&&this.output.push(d.close);this.skipBr=!1}}},sortPriority:function(a,
b){return a.priority<b.priority?-1:a.priority>b.priority?1:0},applyFilters:function(a,b,d){var c,f;for(f in this.filters)if(this.filters.hasOwnProperty(f)){var g=this.filters[f];g[b]&&"function"===typeof g[b][d]&&(c=g[b][d].apply(g,[this,a]));if(!1===c)return!1}return"undefined"===typeof c?!0:c},reset:function(){this.output=[];this.skipBr=!1}};CKEDITOR.plugins.bbCode.BBCodeRule=function(a,b,d,c){var f=[];this.bbCodeTag=b;this.htmlTag=d;this.editor=a;c&&(this.options=CKEDITOR.tools.extend({},this.options,
c,!0));f.push(j(this.htmlTag));for(a=0;a<this.options.alternativeTags.length;++a)f.push(j(this.options.alternativeTags[a]));this.htmlRegExp=RegExp("^("+f.join("|")+")$","i")};CKEDITOR.plugins.bbCode.BBCodeRule.prototype={bbCodeTag:"",htmlTag:"",htmlRegExp:null,editor:null,options:{priority:-1,renderOpenTagHtml:null,renderCloseTagHtml:null,renderOpenTagBBCode:null,renderCloseTagBBCode:null,brBeforeOpen:!1,brBeforeClose:!1,brAfterOpen:!1,brAfterClose:!1,parseContent:!0,optionalClose:!0,alternativeTags:[],
context:[],children:[],attributes:{}},checkValidBBCodeContext:function(a){var b,d=!1,c=this.options.context.length;if(c){b=0;a:for(;b<this.options.context.length;++b){var c=1,f=this.options.context[b].tag,g=this.options.context[b].maxLevel,e=a.parent;isNaN(g)&&(g=Number.POSITIVE_INFINITY);do{if(e.type!==CKEDITOR.NODE_ELEMENT){d=!f&&0!==g&&g<=c||0===g;continue a}else if(f.bbCodeTag!==e.name){++c;continue}else if(0===g){d=!1;continue a}else if(g>=c){d=!0;continue a}++c}while((e=e.parent)&&c<=g)}}else d=
!0;if(c=this.options.children.length)for(b=0;b<c;++b)var h=this.options.children[b].bbCodeTag,d=a.forEach(function(){return a.type===CKEDITOR.NODE_ELEMENT&&a.name!==h?!1:!0});return this.fire("checkBBCodeContext",{isValid:d,node:a},this.editor).isValid},checkValidHtmlContext:function(a){var b,d=!1,c=this.options.context.length;if(c){b=0;a:for(;b<this.options.context.length;++b){var c=1,f=this.options.context[b].tag,g=this.options.context[b].maxLevel,e=a.parent;isNaN(g)&&(g=Number.POSITIVE_INFINITY);
do{if(e.type!==CKEDITOR.NODE_ELEMENT){d=!f&&0!==g&&g<=c||0===g;continue a}else if(e.name.match(f.htmlRegExp))if(0===g){d=!1;continue a}else{if(g>=c){d=!0;continue a}}else{++c;continue}++c}while((e=e.parent)&&c<=g)}}else d=!0;if((c=this.options.children.length)&&!a.isEmpty)for(b=0;b<c;++b){f=this.options.children[b];for(b=0;b<a.children.length;++b)if(a.children[b].type===CKEDITOR.NODE_ELEMENT&&!a.children[b].name.match(f.htmlRegExp)){d=!1;break}}return this.fire("checkHtmlContext",{isValid:d,node:a},
this.editor).isValid},toBBCode:function(a){var b,d={name:this.bbCodeTag,priority:this.options.priority,renderOpenTag:this.options.renderOpenTagBBCode,renderCloseTag:this.options.renderCloseTagBBCode,brBeforeOpen:this.options.brBeforeOpen,brBeforeClose:this.options.brBeforeClose,brAfterOpen:this.options.brAfterOpen,brAfterClose:this.options.brAfterClose,parseContent:this.options.parseContent,stripContent:this.stripContent,value:null,attributes:{}};if(!1===this.fire("beforeToBBCode",{node:a,bbCode:d},
this.editor))return!1;for(b in this.options.attributes)if(this.options.attributes.hasOwnProperty(b)){var c=this.options.attributes[b],f,g,e;"style"!==b?(f=a.attributes,g=b):c.style?(f=a.attributes.style,g=c.style):(f={style:CKEDITOR.tools.writeCssText(a.attributes.style)},g="style");if(!c.hasOwnProperty("value")&&f[g]){var h=[f[g]];e=f[g];if(!c.hasOwnProperty("htmlPattern")||(h=e.match(c.htmlPattern)))if("function"===typeof c.htmlFormat)e=c.htmlFormat.apply(this,h);else{if("string"===typeof c.htmlFormat){e=
c.htmlFormat;for(var i in h)h.hasOwnProperty(i)&&(e=e.replace(RegExp(j("{"+i+"}"),"g"),h[i]))}}else e=void 0}else c.value&&(c.value instanceof RegExp?e=c.value.test(f[g])?c.value:void 0:"class"===g?e=RegExp("(\\s|^)"+j(c.value)+"(\\s|$)","g").test(f[g])?c.value:void 0:c.value===f[g]&&(e=c.value));if("undefined"!==typeof e)c.map&&(!0===c.decode||"undefined"===typeof c.decode?e=CKEDITOR.tools.htmlDecodeAttr(e):"function"===typeof c.decode&&(e=c.decode(e)),"$"===c.map?d.value=e:d.attributes[c.map]=e);
else if(c.required)return!1}return this.fire("toBBCode",{node:a,bbCode:d},this.editor).bbCode},toHtml:function(a){var b,d={name:this.htmlTag,priority:this.options.priority,renderOpenTag:this.options.renderOpenTagHtml,renderCloseTag:this.options.renderCloseTagHtml,brBeforeOpen:this.options.brBeforeOpen,brBeforeClose:this.options.brBeforeClose,brAfterOpen:this.options.brAfterOpen,brAfterClose:this.options.brAfterClose,parseContent:this.options.parseContent,stripContent:this.stripContent,attributes:{style:{}}};
if(!1===this.fire("beforeToHtml",{node:a,html:d},this.editor))return!1;for(b in this.options.attributes)if(this.options.attributes.hasOwnProperty(b)){var c=this.options.attributes[b],f;if(c.map){if(!c.hasOwnProperty("value")&&a.attributes[c.map]){var g=[a.attributes[c.map]];f=a.attributes[c.map];if(!c.hasOwnProperty("bbCodePattern")||(g=f.match(c.bbCodePattern)))if("function"===typeof c.bbCodeFormat)f=c.bbCodeFormat.apply(this,g);else{if("string"===typeof c.bbCodeFormat){f=c.bbCodeFormat;for(var e in g)g.hasOwnProperty(e)&&
(f=f.replace(RegExp(j("{"+e+"}"),"g"),g[e]))}}else f=void 0}else c.value instanceof RegExp||(f=c.value);if("undefined"!==typeof f)!0===c.encode||"undefined"===typeof c.encode?f=CKEDITOR.tools.htmlEncodeAttr(f):"function"===typeof c.encode&&(f=c.encode(f)),"style"===b&&c.style?d.attributes.style[c.style]=f:d.attributes[b]=f;else if(c.required)return!1}}return this.fire("toHtml",{node:a,html:d},this.editor).html}};CKEDITOR.plugins.bbCode.SmileyFilter=function(a){this.smileyPath=a.config.smiley_path;
this.smileyMap={};this.smileyRegExp=[];for(var b=0;b<a.config.smiley_images.length;++b)a.config.smiley_descriptions[b]&&(this.smileyMap[a.config.smiley_descriptions[b]]=a.config.smiley_images[b],this.smileyRegExp.push(j(a.config.smiley_descriptions[b])));this.smileyRegExp=this.smileyRegExp.length?RegExp("("+this.smileyRegExp.join("|")+")","g"):null};CKEDITOR.plugins.bbCode.SmileyFilter.prototype={bbCode:{beforeParse:function(a,b){var d=b.node,c;if(b.parse&&d.type===CKEDITOR.NODE_ELEMENT&&(c=d.attributes.alt||
d.attributes.title)&&"img"===d.name&&this.smileyMap.hasOwnProperty(c))b.node=new CKEDITOR.htmlParser.text(m(c))}},html:{afterParse:function(a,b){var d=b.node;if(this.smileyRegExp&&b.parse&&d.type===CKEDITOR.NODE_TEXT){var c=this;b.content=b.content.replace(this.smileyRegExp,function(a){var b=CKEDITOR.tools.htmlEncodeAttr(a);return'<img src="'+c.smileyPath+c.smileyMap[a]+'" alt="'+b+'" title="'+b+'"></img>'})}}}};CKEDITOR.event.implementOn(CKEDITOR.plugins.bbCode.BBCodeRule.prototype);CKEDITOR.on("dialogDefinition",
function(a){var b=a.data.definition;switch(a.data.name){case "link":b.removeContents("target");b.removeContents("upload");b.removeContents("advanced");a=b.getContents("info");a.remove("emailSubject");a.remove("emailBody");a.get("linkType").items.splice(1,1);break;case "image":b.removeContents("advanced");a=b.getContents("Link");a.remove("cmbTarget");a=b.getContents("info");a.remove("basic");break;case "videoDialog":a=b.getContents("video"),a.remove("width"),a.remove("height")}});CKEDITOR.plugins.add("bbcode",
{requires:["widget","htmlwriter"],version:1,beforeInit:function(a){CKEDITOR.tools.extend(a.config,{basicEntities:!1,entities:!1,fillEmptyBlocks:!1,forcePasteAsPlainText:!0,font_names:'Georgia/Georgia, serif;Palatino/"Palatino Linotype", "Book Antiqua", Palatino, serif;Times New Roman/"Times New Roman", Times, serif;Arial/Arial, Helvetica, sans-serif;Helvetica/Helvetica, sans-serif;Arial Black/"Arial Black", Gadget, sans-serif;Comic Sans MS/"Comic Sans MS", cursive, sans-serif;Impact/Impact, Charcoal, sans-serif;Lucida Sans/"Lucida Sans Unicode", "Lucida Grande", sans-serif;Tahoma/Tahoma, Geneva, sans-serif;Trebuchet MS/"Trebuchet MS", Helvetica, sans-serif;Verdana/Verdana, Geneva, sans-serif;Courier New/"Courier New", Courier, monospace;Lucida Console/"Lucida Console", Monaco, monospace;',
fontSize_sizes:"25%;50%;75%;100%;125%;175%;200%;225%;275%;300%;"});a.bbCode=new CKEDITOR.plugins.bbCode.BBCode(a)},init:function(a){if(a.elementMode===CKEDITOR.ELEMENT_MODE_INLINE)a.on("contentDom",function(){a.on("setData",function(b){b.data.dataValue=a.bbCode.toHtml(b.data.dataValue)},null,null,1);a.on("toDataFormat",function(b){b.data.dataValue=a.bbCode.toBBCode(b.data.dataValue)},null,null,20)});else a.on("setData",function(b){b.data.dataValue=a.bbCode.toHtml(b.data.dataValue)},null,null,1),a.on("toDataFormat",
function(b){b.data.dataValue=a.bbCode.toBBCode(b.data.dataValue)},null,null,20),a.on("selectionChange",function(a){if((a=a.data.path.block)&&"li"===a.getName()){var d=a.getStyle("text-align");if(d){var c=a.getParent(),f=c.getParent();a.removeStyle("text-align");f.getStyle("text-align")?f.setStyle("text-align",d):c.setStyle("text-align",d)}}})}})})();